(()=>{"use strict";var e,t,i,r,o,n,a={},l={};function s(e){var t=l[e];if(void 0!==t)return t.exports;var i=l[e]={id:e,loaded:!1,exports:{}};return a[e](i,i.exports,s),i.loaded=!0,i.exports}s.m=a,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s.a=(o,n,a)=>{var l;a&&((l=[]).d=-1);var s,d,c,u=new Set,y=o.exports,p=new Promise(((e,t)=>{c=t,d=e}));p[t]=y,p[e]=e=>(l&&e(l),u.forEach(e),p.catch((e=>{}))),o.exports=p,n((o=>{var n;s=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var n=[];n.d=0,o.then((e=>{a[t]=e,r(n)}),(e=>{a[i]=e,r(n)}));var a={};return a[e]=e=>e(n),a}}var l={};return l[e]=e=>{},l[t]=o,l})))(o);var a=()=>s.map((e=>{if(e[i])throw e[i];return e[t]})),d=new Promise((t=>{(n=()=>t(a)).r=0;var i=e=>e!==l&&!u.has(e)&&(u.add(e),e&&!e.d&&(n.r++,e.push(n)));s.map((t=>t[e](i)))}));return n.r?d:a()}),(e=>(e?c(p[i]=e):d(y),r(l)))),l&&l.d<0&&(l.d=0)},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,i)=>(s.f[i](e,t),t)),[])),s.u=e=>e+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={},n="watermeloncombine:",s.l=(e,t,i,r)=>{if(o[e])o[e].push(t);else{var a,l;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+i){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+i),a.src=e),o[e]=[t];var y=(t,i)=>{a.onerror=a.onload=null,clearTimeout(p);var r=o[e];if(delete o[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(i))),t)return t(i)},p=setTimeout(y.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=y.bind(null,a.onerror),a.onload=y.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.v=(e,t,i,r)=>{var o=fetch(s.p+""+i+".module.wasm"),n=()=>o.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,r))).then((t=>Object.assign(e,t.instance.exports)));return o.then((t=>"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,r).then((t=>Object.assign(e,t.instance.exports)),(e=>{if("application/wasm"!==t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),n();throw e})):n()))},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,i)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var o=new Promise(((i,o)=>r=e[t]=[i,o]));i.push(r[2]=o);var n=s.p+s.u(t),a=new Error;s.l(n,(i=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+n+")",a.name="ChunkLoadError",a.type=o,a.request=n,r[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,o,[n,a,l]=i,d=0;if(n.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);l&&l(s)}for(t&&t(i);d<n.length;d++)o=n[d],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0},i=self.webpackChunkwatermeloncombine=self.webpackChunkwatermeloncombine||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();const d=function(e,t,i){if(!e)throw"gimme rapier yo";const r=window.setTimeout,o=window.setInterval,n=window.clearInterval,a={red:{fillStyle:"#FF0000",radius:12,type:"circle"},blue:{fillStyle:"#0000FF",radius:45,type:"circle"},aqua:{fillStyle:"#00FFFF",radius:75,type:"circle"},green:{fillStyle:"#008000",radius:100,type:"circle"},yellow:{fillStyle:"#FFFF00",radius:130,type:"circle"},purple:{fillStyle:"#800080",radius:155,type:"circle"},orange:{fillStyle:"#FFA500",radius:185,type:"circle"},pink:{fillStyle:"#FFC0CB",radius:200,type:"circle"},brown:{fillStyle:"#A52A2A",radius:215,type:"circle"},black:{fillStyle:"#000000",radius:260,shadowBlur:80,effect:"pulse",type:"circle",hasStroke:!0},r:{fillStyle:"r",radius:50,shadowBlur:200,effect:"dance",type:"circle"},t:{fillStyle:"#FF0000",strokeStyle:"#cccccc",hasStroke:!0,lineWidth:5,radius:80,type:"triangle",spawnSpin:.1}},l={group:1},s=1366,d=777;let c,u,y=683,p=388.5,h=1e7*Math.random(),f=0,g=!0;const m=Math.random().toString(36).substring(7);let b=0,w=!1,v=0,M=0,S=[],k=[],x=-1,B=100;const T=.4,E=500,C=60;let D=[],F=[];function O(e){var t=2**35-31,i=e%t;return function(){return(i=185852*i%t)/t}}this.loadExtraOptions=e=>{i=e};let I=O(h);function R(){return v++,I()}function j(){I=O(h),v=0}this.setSeed=e=>{h=e,j()},this.setMinimalDuplicates=e=>{w=e};const A=new e.EventQueue(!0),P=new e.World({x:0,y:9.81}),L=t?.getContext("2d"),N=e=>{e.forEach((e=>{const t={};switch(e.position?(t.x=e.position.x,t.y=e.position.y):(t.x=e.rigidBody.translation().x*B,t.y=e.rigidBody.translation().y*B),L.save(),L.beginPath(),function(e){const t=`hsl(${Date.now()/5%360}, 100%, 50%)`;let i=e.render.fillStyle;if("r"===i&&(i=t),L.fillStyle=i,L.strokeStyle=e.render.strokeStyle,L.lineWidth=e.render.lineWidth||0,L.shadowColor=e.render.shadowColor||L.fillStyle,L.shadowBlur=e.render.shadowBlur,L.globalAlpha=e.render.opacity,"pulse"===e.render.effect){let t=e.render.shadowBlur;L.shadowBlur=t?t*(Math.abs(Date.now()/50%t-t/2)/t):0}if("dance"===e.render.effect){const e=50,t=Math.cos(Date.now()/500)*e,i=Math.sin(Date.now()/500)*e;L.shadowOffsetX=t,L.shadowOffsetY=i}}(e),e.type){case"text":L.font="30px Arial",L.fillText(e.text,t.x,t.y);break;case"circle":const i=e.circleRadius||e.colliderDesc.shape.radius*B;if(L.arc(t.x,t.y,i,0,2*Math.PI),L.fill(),!e.noFace){const r=y-t.x,o=p-t.y;let n,a=r/(t.x>y?t.x:s-t.x)*i*.01,l=o/(t.y>p?t.y:d-t.y)*i*.01,c=Math.atan2(o,r),u=Math.sqrt(Math.pow(a,2)+Math.pow(l,2));"#000000"===e.render.fillStyle?L.fillStyle="white":L.fillStyle="black",L.globalAlpha*=.5,L.translate(t.x,t.y),e.rigidBody&&(n=e.rigidBody.rotation(),L.rotate(n)),L.beginPath(),e.isSad?L.arc(0,.25*i,.65*i,1*Math.PI,0):L.arc(0,.05*i,.65*i,0,1*Math.PI),c-=n,a=Math.cos(c)*u,l=Math.sin(c)*u,L.fill(),L.beginPath(),L.arc(.3*i+a,.3*-i+l,.16*i,0,2*Math.PI),L.arc(.3*-i+a,.3*-i+l,.16*i,0,2*Math.PI),L.fill(),L.closePath(),L.globalAlpha*=.2,L.beginPath(),L.arc(.3*i,.3*-i,.18*i,0,2*Math.PI),L.arc(.3*-i,.3*-i,.18*i,0,2*Math.PI),L.fill(),L.closePath()}}L.closePath(),e.render.hasStroke&&L.stroke(),L.restore()}))};function _(e){e?P.setGravity({x:0,y:9.81}):P.setGravity({x:0,y:0})}function q(){c="red",u="red",b=0,M=0,f=0,g=!0,j(),k.forEach((e=>{z(e)})),k=[],$(),t&&Y(K,c)}function $(){c=u;let e=4,t=Math.max(Math.round(6-b/100),3);if(w)for(;e>0;){let i=R();u=Object.keys(a)[Math.floor(Math.pow(i,t)*Object.keys(a).length/2)],u===c?e--:e=0,u===Object.keys(a)[0]&&(e=0)}else{let e=R();u=Object.keys(a)[Math.floor(Math.pow(e,t)*Object.keys(a).length/2)]}J()}function V(t,i,r){let o=e.ColliderDesc.ball(r/B).setRestitution(T),n=e.RigidBodyDesc.dynamic().setTranslation(t/B,i/B).setCcdEnabled(!0),a=P.createRigidBody(n);o.setActiveEvents(e.ActiveEvents.COLLISION_EVENTS),o.setFriction(.1),o.setFrictionCombineRule(e.CoefficientCombineRule.Max),o.setMass(r);let l=P.createCollider(o,a),s={id:Math.random(),type:"circle",renderType:"circle",rigidBody:a,colliderDesc:o,collider:l};return S.push(s),s}function W(t,i,r,o){let n=e.ColliderDesc.cuboid(r/B,o/B),a=e.RigidBodyDesc.fixed().setTranslation(t/B,i/B),l=P.createRigidBody(a);n.setFriction(1),P.createCollider(n,l);let s={type:"rectangle",rigidBody:l,colliderDesc:n,render:{fillStyle:"black"}};return S.push(s),s}function z(e){P.removeRigidBody(e.rigidBody),S=S.filter((t=>t.id!=e.id)),k=k.filter((t=>t.id!=e.id))}function H(e,t){t>=3||k.forEach((i=>{if(i.id==e.id)return;let r=Math.sqrt(Math.pow(i.rigidBody.translation().x-e.rigidBody.translation().x,2)+Math.pow(i.rigidBody.translation().y-e.rigidBody.translation().y,2)),o=i.colliderDesc.shape.radius+e.colliderDesc.shape.radius;console.log(r,o),r<o&&(i.impactedByNew=!0,U(E/C,(()=>{i.impactedByNew=!1})),H(i,t?t+1:1))}))}function U(e,t){D.push({ticks:e,callback:t})}function Y(e,t){e.render={...e.render,...a[t]},t&&"circle"==a[t].type&&(e.circleRadius=a[t].radius)}function G(e,t,i,r){let o;return"circle"===a[e].type?o=V(t,i,a[e].radius):a[e].type,r&&(r.forceRadius&&(z(o),o=V(t,i,r.forceRadius)),r.velocity&&o.rigidBody.setLinvel(r.velocity,!0),Object.assign(o,r)),a[e].spawnSpin&&o.rigidBody.setAngvel(a[e].spawnSpin),Y(o,e),r&&r.forceRadius&&(o.circleRadius=r.forceRadius),o.fruitType=e,o.fruitTypeNumber=Object.keys(a).indexOf(e),o.hitYet=!1,1e4*Math.random()==1&&(o.isSad=!0),k.push(o),H(o),o}function J(e){let i=a[c].radius;y-i<0?y=i:y+i>t.width&&(y=t.width-i),e<t.getBoundingClientRect().left?y=i:e>t.getBoundingClientRect().width+t.getBoundingClientRect().left&&(y=t.width-i),K.position.x=y}this.tick=()=>{D=D.filter((e=>(e.ticks--,!(e.ticks<=0&&(e.callback(),1))))),k=S.filter((e=>e.fruitType)),k.forEach((e=>{const t=e.rigidBody.translation().y;if(t>877&&(e.rigidBody.setTranslation({x:683,y:388.5}),e.rigidBody.setLinvel({x:0,y:0},!0)),e.hitYet){const i=e.rigidBody.linvel(),r=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));let o=5;const n=e.colliderDesc.shape.radius;if((Math.abs(t-X.y)<n||t>X.y)&&(o*=.5),r>o){e.velocityCapped=!0;let t=Math.atan2(i.y,i.x);e.rigidBody.setLinvel({x:Math.cos(t)*o,y:Math.sin(t)*o},!0)}else e.velocityCapped=!1;if(e.lastVelocity){let t={x:Math.abs(e.lastVelocity.x-i.x),y:Math.abs(e.lastVelocity.y-i.y)};Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))>2&&(e.accelLimited=!0,e.rigidBody.setLinearDamping(200),U(E/C,(()=>{e.merged||(e.accelLimited=!1,e.rigidBody.setLinearDamping(0))})))}e.lastVelocity=i}e.impactedByNew?(e.collider.setRestitution(0),e.rigidBody.setLinearDamping(20),e.rigidBody.setAngularDamping(20),e.rigidBody.linvel().y<0&&(e.rigidBody.setLinearDamping(100),e.rigidBody.setAngularDamping(100))):(e.rigidBody.setAngularDamping(0),e.rigidBody.setLinearDamping(0),e.collider.setRestitution(T))})),P.step(A),F=[],A.drainCollisionEvents(((e,r,s)=>{let d,c;F.push([e,r,s]),S.filter((t=>{t.rigidBody&&(t.rigidBody.handle==e?d=t:t.rigidBody.handle==r&&(c=t))})),function(e,r,s){if(e.fruitType&&r.fruitType&&(e.hitYet=!0,r.hitYet=!0),s&&e.fruitType&&r.fruitType&&e.fruitType===r.fruitType){if(e.merged||r.merged)return;e.merged=!0,r.merged=!0,e.onMerge&&e.onMerge(),r.onMerge&&r.onMerge();const s=e.rigidBody.translation(),d=r.rigidBody.translation(),c=(s.x+d.x)/2*B,u=(s.y+d.y)/2*B,y=(e.rigidBody.rotation()+r.rigidBody.rotation())/2,p=function(e){const t=Object.keys(a),i=t.indexOf(e);return t[i+1]}(e.fruitType);if(t){if("r"==p){let e=o((()=>{!function(e,i,r){if(!t)return;const o=a.r.fillStyle;let n=a.r.radius;for(let t=0;t<15;t++){const t=Math.random()*Math.PI*2,r=.002*Math.random(),a=V(e+Math.cos(t)*n,i+Math.sin(t)*n,5);a.render={fillStyle:o,shadowBlur:20,effect:"pulse",opacity:1},a.noFace=!0,a.rigidBody.setLinvel({x:Math.cos(t)*r,y:Math.sin(t)*r},!0),U((2e3+1e3*Math.random())/C,(()=>{z(a)}))}}(Math.random()*window.innerWidth,Math.random()*window.innerHeight)}),80);U(5e3/C,(()=>{n(e)}))}"triangle"==p&&(function(e,i,r){if(!t)return;const a={id:Math.random(),type:"circle",position:{x:e,y:i},circleRadius:5,renderFirst:!0,render:{strokeStyle:"black",lineWidth:4,opactiy:1}};S.push(a);let l=1,s=o((()=>{l<0&&(n(s),S=S.filter((e=>e.id!=a.id))),a.circleRadius+=l,l+=-.002,a.render.opacity=l/1+1e-4}),1)}(c,u),function(){var e=-1;_(!1),g=!1;let t=()=>{engine.world.bodies.forEach((e=>{e.velocity.x=0,e.velocity.y=0}));let i=[];for(;i.length<=1;)if(e++,i=k.filter((t=>t.fruitTypeNumber==e)),e>10)return engine.world.bodies.forEach((e=>{e.collisionFilter=l})),engine.world.gravity.y=1,void(g=!0);let r=Math.floor(i.length/2),o=0;for(var n=0;n<i.length-1;n+=2){var a=i[n],s=i[n+1];if(a.position.y>s.position.y){let e=a;a=s,s=e}var d={group:1e5*Math.random()};a.collisionFilter=d,s.collisionFilter=d;var c=a.position,u=s.position;let e=Math.sqrt(Math.pow(u.x-c.x,2)+Math.pow(u.y-c.y,2));var y=5e-5*a.mass*e;let l=Math.atan2(u.y-c.y,u.x-c.x);var p={x:Math.cos(l)*y,y:Math.sin(l)*y};Body.applyForce(a,a.position,p);let h=U(3e3/C,(()=>{a.merged||Composite.remove(engine.world,a),s.merged||Composite.remove(engine.world,s),o++,o==r&&t()}));a.onMerge=()=>{o++,clearTimeout(h),o==r&&U(1e3/C,(()=>{t()}))}}};U(5e3/C,t)}())}const h=Math.pow(Object.keys(a).indexOf(e.fruitType)+1,2);M+=h,i?.onScoreChange?.(M),i?.onMerge?.({bodies:[e,r],newType:p,score:M});let f=G(p,c,u);f.impactedByNew=!0,f.rigidBody.setRotation(y),(e.isSad||r.isSad)&&(f.isSad=!0),U(E/C,(()=>{f.impactedByNew=!1})),z(e),z(r),t&&function(e,i,r){if(!t)return;const o=Math.random();U(2e3/C,(()=>{S=S.filter((e=>e.id!=o))}))}()}}(d,c,s)})),g&&0==k.filter((e=>{if(!e.hitYet)return!1;const r=e.rigidBody.linvel().y,a=e.rigidBody.linvel().x,l=e.colliderDesc.shape.radius,s=e.rigidBody.translation();if(Math.sqrt(Math.pow(r,2)+Math.pow(a),2)>3)return!1;if(Math.abs(r)+Math.abs(a)>3)return!1;let d=(s.y+l)*B<X.y;if(d)if(-1!=x){let e=3e3,r=Date.now()-x;if(t&&(X.fill=`rgb(${r/e*255},0,0)`),r>e&&g)return i?.onGameOver?.(M),void function(e){_(!1),x=Number.MAX_VALUE,g=!1;let t=o((()=>{if(0==k.length)_(!0),x=-1,g=!0,n(t),e&&e();else{let e=Math.floor(Math.random()*k.length);z(k[e])}}),15)}((()=>{q()}))}else x=Date.now();return d})).length&&(x=-1,X.fill="rgb(0,0,0)")},this.loop=()=>{this.tick(),t&&(()=>{L.clearRect(0,0,s,d),L.save(),L.fillStyle=X.fill,L.fillRect(0,X.y,s,10),L.restore();const e=S.filter((e=>e.renderFirst)),t=S.filter((e=>!e.renderFirst));N(e),N(t)})(),r(this.loop,1e3/C)},this.resetToDefaultValues=q,this.addFruit=G,this.loadFromState=e=>{c=e.currentType,u=e.nextType,t&&(Y(K,c),i?.onSyncFromState?.()),w=e.minimizeDuplicates,b=e.drops,v=e.randsGenerated,M=e.score,i?.onScoreChange?.(M),f=e.lastDropTime,k.forEach((e=>{z(e)})),e.fruits.forEach((function(e){let t=G(e.fruitType,e.position.x*B,e.position.y*B,{velocity:e.velocity});t.rigidBody.setRotation(e.angle),t.isSad=e.sad})),I=O(h);for(let e=0;e<v;e++)I()},this.getFullState=()=>({fruits:k.map((e=>{const t=e.rigidBody.translation(),i=e.rigidBody.linvel(),r=e.rigidBody.rotation();return{position:t,velocity:i,fruitType:e.fruitType,angle:r,sad:e.isSad}})),currentType:c,nextType:u,drops:b,randsGenerated:v,score:M,lastDropTime:f,minimizeDuplicates:w}),this.getNextDropColor=()=>a[u].fillStyle,this.handleClick=e=>{t&&g&&(Date.now()-f<500||(f=Date.now(),localStorage.setItem("lastInteract",m),b++,G(c,y,30),$(),Y(K,c),K.position.y=-9999,U(500/C,(()=>{K.position.y=30})),i?.onDrop?.()))},this.handleMove=e=>{if(!t)return;const i=e.clientX;y=(i-t.getBoundingClientRect().left)/t.getBoundingClientRect().width*t.width,p=e.clientY,J(i)},W(0,787,s,10),W(1376,388.5,10,d),W(-10,388.5,10,d);const X={fill:"#000",y:60};let K={renderType:"circle",type:"circle",renderFirst:!0,position:{x:683,y:30},render:{fillStyle:"red"},circleRadius:5};t&&(S.push(K),Y(K,c)),this.resetToDefaultValues()};s.e(727).then(s.bind(s,727)).then((e=>{(window.innerHeight>500||window===window.top)&&(document.body.style.display="unset"),window.location.hash.includes("noembed")&&document.getElementById("warn").remove();const t=new Audio("pop.mp3"),i=document.getElementById("gameCanvas");window.onresize=()=>{Object.assign(i.style,{...777*window.innerWidth/1366>window.innerHeight?{height:"100vh",width:"auto"}:{width:"100vw",height:"auto"}})},window.onresize();const r=document.getElementById("score");let o="casual",n=new d(e,i);function a(){let e=localStorage.getItem("state");e&&(e=JSON.parse(e),o=e.minimizeDuplicates?"casual":"ranked",rankedToggle.checked="ranked"===o,n.loadFromState(e))}function l(){const e=n.getFullState();localStorage.setItem("state",JSON.stringify(e))}n.setSeed(1),c();const s={onDrop:()=>{!function(){if(location.href.includes("file"))return;if(location.href.includes("localhost"))return;let e=Number(localStorage.getItem("clicks")||0);e++,localStorage.setItem("clicks",e),10==e&&(fetch(u+"?clicks="+e),localStorage.setItem("clicks",0))}(),l(),c()},onMerge:e=>{t.cloneNode().play(),l()},onScoreChange:e=>{r.innerText=e},onGameOver:e=>{!async function(e,t){let i=prompt("Enter your name if you would like to submit your score to leaderboard. Use your real name and don't put anything bad pls 🙏");if(!i)return;{let e=await fetch(`https://www.purgomalum.com/service/json?text=${i}`);i=(await e.json()).result}let r=function(e){let t,i,r,o;for(i=atob(e.split(",")[1]),t=[],r=0,o=i.length;r<o;)t.push(i.charCodeAt(r)),r++;return new Blob([new Uint8Array(t)],{type:"image/png"})}(t),n=new FormData;n.append("image",r);let a=await fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID a23332bdafb3fb9"},body:n}),l=(await a.json()).data.link,s={name:i,score:e,canvasString:l,mode:o},d=btoa(JSON.stringify(s));d=d.split("").reverse().join("");let c=await fetch(`${u}?data=${encodeURIComponent(d)}`),y=await c.json();h="cas"===o,f(),m(y),leaderboardPopup.style.display="block";let p=document.getElementById("leaderboardEntries"),g=p.getElementsByClassName("leaderboardImage");for(let e=0;e<g.length;e++)if(g[e].src==l){p.scrollTop=g[e].offsetTop,g[e].style.border="5px solid black",setTimeout((()=>{g[e].style.border="none"}),5e3);break}}(e,i.toDataURL()),localStorage.removeItem("state"),r.innerText="0",c()},onSyncFromState:()=>{c()}};function c(){r.style.borderRight=`5px solid ${n.getNextDropColor()}`}n.loadExtraOptions(s),a(),n.loop(),document.onclick=e=>{e.isTrusted&&(e.target.classList.contains("nodrop")||n.handleClick(e))},document.onmousemove=n.handleMove,document.addEventListener("visibilitychange",(()=>{document.hidden||a()})),r.onclick=()=>{confirm("Are you sure you want to restart? Manually restarting means your score won't have a chance to go on the leaderboard")&&(n.resetToDefaultValues(),r.innerText="0",l(),a())},rankedToggle.oninput=e=>{"ranked"===o?confirm("Ball order in casual is completely random. \n\n Switching modes mid round will clear all balls, continue?")?(n.setMinimalDuplicates(!0),n.setSeed(1e7*Math.random()),n.resetToDefaultValues(),l(),a(),rankedToggle.checked=!1):rankedToggle.checked=!0:confirm("Ball order in ranked is always the same. \n\n Switching modes mid round will clear all balls, continue?")?(n.setMinimalDuplicates(!1),n.setSeed(1),n.resetToDefaultValues(),l(),a(),rankedToggle.checked=!0):rankedToggle.checked=!1};const u="https://script.google.com/macros/s/AKfycbw6iTqt_fyO5OtTZ9de3pZUEglgvTH9tlVxkiPmlpkjaRpoqz0vn8IK_CddqT3F3OLsTw/exec";document.getElementById("leaderboardButton").onclick=()=>{leaderboardPopup.style.display="block"},document.getElementById("leaderboardPopup").onclick=e=>{"leaderboardPopup"==e.target.id&&(leaderboardPopup.style.display="none")};let y=[],p=[],h=!0;function f(){leaderboardModeToggle.innerText=h?"Ranked":"Casual",leaderboardHeader.innerText=h?"Casual Leaderboard":"Ranked Leaderboard",leaderboardSubtitle.innerText=h?"Balls drop in a random order in casual mode.":"Balls always drop in the same order in ranked mode."}function g(){h&&y.length>0||!h&&p.length>0?m(h?y:p):(document.getElementById("leaderboardEntries").innerHTML="",fetch(u+"?mode="+(h?"cas":"ranked")).then((e=>e.json())).then((e=>{h?y=e:p=e,m(e)})))}function m(e){e=e.sort(((e,t)=>t[1]-e[1]));let t=document.getElementById("leaderboardEntries");t.innerHTML="",e.forEach(((e,i)=>{let r=document.createElement("div");r.classList.add("leaderboardEntry"),r.classList.add("nodrop"),r.innerText=`${i+1}.  ${e[0]} - ${e[1]}`,t.appendChild(r);let o=document.createElement("div");r.appendChild(o);let n=document.createElement("img");n.classList.add("leaderboardImage"),n.classList.add("nodrop"),n.src=e[2],n.style.width="100px",n.style.objectFit="cover",n.onclick=t=>{var i;i=e[2],window.open().document.write(`<div style="\n    thisisxssablelolbutidontcarecuzitwouldbekindafunnyifsomebodydidit:true;\n    background-image: url(${i});\n    width: 100vw;\n    height: 100vh;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n">\n    \n</div>`),setInterval((()=>{y=[],p=[]}),6e4)},o.appendChild(n),0==i&&(r.style.color="gold",o.classList.add("leaderContainer"))}))}leaderboardModeToggle.onclick=()=>{h=!h,f(),g()},g()}))})();